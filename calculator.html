<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>資金計画シミュレーター | 牛田商事 – BIツール活用サポート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="投資シミュレーター。自己資金、借入額、利率、期間を入力してキャッシュフローを試算できます。" />
  <style>
    :root {
      --primary: #1c3b70;
      --primary-light: #f1f5fb;
      --accent: #0078d4;
      --text-main: #222;
      --text-muted: #666;
      --border-soft: #e2e8f0;
      --bg: #ffffff;
      --card-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Yu Gothic", "Meiryo", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
    }
    a { color: inherit; text-decoration: none; }
    .container {
      width: 100%;
      max-width: 1040px;
      margin: 0 auto;
      padding: 0 16px;
    }
    header {
      border-bottom: 1px solid var(--border-soft);
      background: rgba(255,255,255,0.96);
      backdrop-filter: blur(12px);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      gap: 12px;
    }
    .logo { font-weight: 700; font-size: 18px; color: var(--primary); }
    .logo-sub { font-size: 11px; color: var(--text-muted); }
    nav ul { list-style: none; display: flex; gap: 16px; font-size: 14px; flex-wrap: wrap; }
    nav a { color: var(--text-muted); white-space: nowrap; }
    nav a:hover { color: var(--primary); }
    nav a.is-current { color: var(--primary); font-weight: 600; }

    main { padding: 32px 0 48px; }
    .page-title { font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 6px; }
    .page-lead { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }

    .card {
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-shadow);
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 12px;
    }
    .field label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .field input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      font-size: 15px;
      transition: border-color 0.2s ease;
    }
    .field input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.08);
    }
    .helper { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

    .actions { display: flex; gap: 12px; align-items: center; margin-top: 8px; flex-wrap: wrap; }
    .btn-primary {
      padding: 10px 18px;
      background: var(--accent);
      color: #fff;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 24px rgba(0,120,212,0.18);
    }
    .btn-primary:hover { transform: translateY(-1px); }
    .btn-secondary {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #fff;
      color: var(--text-main);
      cursor: pointer;
    }

    .status { font-size: 12px; color: var(--text-muted); margin-top: 6px; }
    .status.error { color: #c0392b; }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .summary-card {
      border: 1px solid var(--border-soft);
      border-radius: 10px;
      padding: 12px;
      background: var(--primary-light);
    }
    .summary-card h3 { font-size: 13px; color: var(--primary); margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; color: var(--primary); }
    .summary-card small { font-size: 12px; color: var(--text-muted); }

    .table-wrapper { margin-top: 18px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 10px 8px; border-bottom: 1px solid var(--border-soft); text-align: right; }
    th { color: var(--text-muted); font-weight: 600; text-align: left; white-space: nowrap; }
    tbody tr:last-child td { border-bottom: none; }

    .note-list { margin-top: 14px; color: var(--text-muted); font-size: 13px; }
    .note-list li { margin-left: 1em; margin-bottom: 4px; }

    @media (max-width: 840px) {
      .header-inner { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-inner">
      <a href="index.html">
        <div class="logo">牛田商事</div>
        <div class="logo-sub">BIツール活用サポート – Power BI / Tableau / Power Query</div>
      </a>
      <nav>
        <ul>
          <li><a href="index.html">トップ</a></li>
          <li><a href="services.html">詳しいサービス</a></li>
          <li><a href="calculator.html" class="is-current">資金計画</a></li>
          <li><a href="index.html#flow">ご依頼の流れ</a></li>
          <li><a href="index.html#profile">プロフィール</a></li>
          <li><a href="index.html#contact">お問い合わせ</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">資金計画シミュレーター</h1>
    <p class="page-lead">自己資金・借入条件・収支を入力すると、月次/年次キャッシュフローと残債を概算します。ゼロや負の値は自動的に0として扱い、計算不能な場合はお知らせします。</p>

    <section class="card" aria-label="入力フォーム">
      <form id="calc-form">
        <div class="form-grid">
          <div class="field">
            <label for="selfFunding">自己資金 (円)</label>
            <input type="number" id="selfFunding" name="selfFunding" inputmode="decimal" min="0" placeholder="5000000" />
            <div class="helper">頭金や手元資金。0以下は0として計算します。</div>
          </div>
          <div class="field">
            <label for="loanAmount">借入額 (円)</label>
            <input type="number" id="loanAmount" name="loanAmount" inputmode="decimal" min="0" placeholder="15000000" required />
            <div class="helper">物件価格のうち借り入れる金額。</div>
          </div>
          <div class="field">
            <label for="interestRate">年利 (%)</label>
            <input type="number" id="interestRate" name="interestRate" inputmode="decimal" step="0.01" placeholder="1.5" />
            <div class="helper">変動/固定どちらでも。負の値は0%として扱います。</div>
          </div>
          <div class="field">
            <label for="termYears">返済期間 (年)</label>
            <input type="number" id="termYears" name="termYears" inputmode="decimal" min="0" placeholder="30" />
            <div class="helper">0年の場合は1ヶ月で完済する想定になります。</div>
          </div>
          <div class="field">
            <label for="grossYield">年間賃料収入 (円)</label>
            <input type="number" id="grossYield" name="grossYield" inputmode="decimal" min="0" placeholder="1200000" />
            <div class="helper">満室時などの年間賃料収入。利回り計算に使用します。</div>
          </div>
          <div class="field">
            <label for="otherIncome">その他収入 (円 / 月)</label>
            <input type="number" id="otherIncome" name="otherIncome" inputmode="decimal" min="0" placeholder="20000" />
            <div class="helper">共益費・広告料など月次で見込む収入。</div>
          </div>
          <div class="field">
            <label for="recurringExpenses">維持費 (円 / 月)</label>
            <input type="number" id="recurringExpenses" name="recurringExpenses" inputmode="decimal" min="0" placeholder="50000" />
            <div class="helper">管理費・修繕積立などの固定支出。</div>
          </div>
          <div class="field">
            <label for="taxes">税金 (円 / 年)</label>
            <input type="number" id="taxes" name="taxes" inputmode="decimal" min="0" placeholder="120000" />
            <div class="helper">固定資産税など年間でかかる税金。</div>
          </div>
        </div>
        <div class="actions">
          <button type="submit" class="btn-primary">計算する</button>
          <button type="reset" class="btn-secondary">リセット</button>
          <div id="status" class="status" role="status" aria-live="polite"></div>
        </div>
      </form>
    </section>

    <section class="card" style="margin-top: 18px;" aria-label="計算結果">
      <h2 style="font-size: 18px; color: var(--primary); margin-bottom: 8px;">結果サマリー</h2>
      <p class="status" id="summary-note">入力すると自動で計算結果が表示されます。</p>
      <div class="summary-grid" id="summary-cards">
        <div class="summary-card">
          <h3>手残り額 (月次)</h3>
          <div class="value" id="net-cash">-</div>
          <small>家賃収入＋その他収入 − 維持費 − 返済</small>
        </div>
        <div class="summary-card">
          <h3>返済額 (月次)</h3>
          <div class="value" id="monthly-repay">-</div>
          <small>元利均等返済で概算</small>
        </div>
        <div class="summary-card">
          <h3>利回り (年間)</h3>
          <div class="value" id="roi">-</div>
          <small>年間キャッシュフロー ÷ 自己資金</small>
        </div>
        <div class="summary-card">
          <h3>キャッシュフロー推移</h3>
          <div class="value" id="trend-mini">-</div>
          <small>12ヶ月の平均</small>
        </div>
      </div>

      <div class="table-wrapper" aria-live="polite">
        <table>
          <thead>
            <tr>
              <th>月</th>
              <th>返済額</th>
              <th>元金</th>
              <th>利息</th>
              <th>残債</th>
              <th>手残り</th>
            </tr>
          </thead>
          <tbody id="trend-body"></tbody>
        </table>
      </div>

      <ul class="note-list">
        <li>利息は入力した年利を12で割った単利ベースの概算です。変動金利・繰上げ返済は考慮していません。</li>
        <li>ゼロ・負の値は0として扱い、期間が0の場合は1ヶ月で完済するとみなします。</li>
        <li>計算結果はシミュレーションであり、実際のローン条件・税制とは異なる場合があります。</li>
      </ul>
    </section>
  </main>

  <footer class="container" style="padding: 18px 0 24px; font-size: 11px; color: var(--text-muted); border-top: 1px solid var(--border-soft); text-align: center;">
    &copy; 2024 牛田商事 – BIツール活用サポート
  </footer>

  <script>
    const form = document.getElementById('calc-form');
    const statusEl = document.getElementById('status');
    const summaryNote = document.getElementById('summary-note');
    const netCashEl = document.getElementById('net-cash');
    const repayEl = document.getElementById('monthly-repay');
    const roiEl = document.getElementById('roi');
    const trendMiniEl = document.getElementById('trend-mini');
    const trendBody = document.getElementById('trend-body');

    function toNumber(value) {
      const num = parseFloat(value);
      return Number.isFinite(num) ? num : 0;
    }

    function currency(value) {
      return Math.round(value).toLocaleString('ja-JP');
    }

    function percent(ratio) {
      return (Math.round(ratio * 1000) / 10).toFixed(1) + '%';
    }

    function remainingBalance(principal, monthlyRate, monthlyPayment, months) {
      if (principal <= 0) return 0;
      if (monthlyRate <= 0) {
        const balance = principal - monthlyPayment * months;
        return balance < 0 ? 0 : balance;
      }
      const pow = Math.pow(1 + monthlyRate, months);
      const balance = principal * pow - monthlyPayment * (pow - 1) / monthlyRate;
      return balance < 0 ? 0 : balance;
    }

    function buildSchedule(principal, monthlyRate, monthlyPayment, months, monthlyNetBeforeDebt) {
      const rows = [];
      let balance = principal;
      for (let i = 1; i <= months; i++) {
        const interest = monthlyRate > 0 ? balance * monthlyRate : 0;
        let principalPaid = monthlyPayment - interest;
        if (principalPaid > balance) {
          principalPaid = balance;
        }
        const payment = principal > 0 ? principalPaid + interest : 0;
        balance = Math.max(0, balance - principalPaid);
        const netCash = monthlyNetBeforeDebt - payment;
        rows.push({
          month: i,
          payment,
          principalPaid,
          interest,
          balance,
          netCash,
        });
        if (balance <= 0) break;
      }
      return rows;
    }

    function calculate() {
      const selfFunding = Math.max(0, toNumber(form.selfFunding.value));
      const loanAmount = Math.max(0, toNumber(form.loanAmount.value));
      const interestRate = Math.max(0, toNumber(form.interestRate.value));
      const termYears = Math.max(0, toNumber(form.termYears.value));
      const grossYield = Math.max(0, toNumber(form.grossYield.value));
      const otherIncome = Math.max(0, toNumber(form.otherIncome.value));
      const recurringExpenses = Math.max(0, toNumber(form.recurringExpenses.value));
      const taxes = Math.max(0, toNumber(form.taxes.value));

      const errors = [];
      if (!loanAmount) errors.push('借入額が0円のため返済額は0円で計算します。');
      if (!grossYield && !otherIncome) errors.push('収入項目が未入力です。手残りはマイナスになる可能性があります。');

      const termMonths = Math.max(1, Math.round(termYears * 12));
      const monthlyRate = interestRate > 0 ? interestRate / 100 / 12 : 0;

      let monthlyRepayment = 0;
      if (loanAmount > 0) {
        if (monthlyRate > 0) {
          const pow = Math.pow(1 + monthlyRate, termMonths);
          monthlyRepayment = loanAmount * monthlyRate * pow / (pow - 1);
        } else {
          monthlyRepayment = loanAmount / termMonths;
        }
      }

      const monthlyGrossIncome = grossYield / 12;
      const monthlyTax = taxes / 12;
      const monthlyNetBeforeDebt = monthlyGrossIncome + otherIncome - recurringExpenses - monthlyTax;
      const monthlyCashFlow = monthlyNetBeforeDebt - monthlyRepayment;
      const annualCashFlow = monthlyCashFlow * 12;

      const monthsToShow = Math.min(12, termMonths);
      const schedule = buildSchedule(loanAmount, monthlyRate, monthlyRepayment, monthsToShow, monthlyNetBeforeDebt);
      const remainingAfterYear = remainingBalance(loanAmount, monthlyRate, monthlyRepayment, monthsToShow);

      const roiBase = selfFunding > 0 ? selfFunding : (loanAmount > 0 ? loanAmount : 1);
      const roiValue = roiBase > 0 ? (annualCashFlow / roiBase) : 0;

      statusEl.textContent = errors.length ? errors.join(' / ') : '最新の計算結果を表示しています。';
      statusEl.classList.toggle('error', Boolean(errors.length));

      netCashEl.textContent = `${currency(monthlyCashFlow)} 円`;
      repayEl.textContent = loanAmount > 0 ? `${currency(monthlyRepayment)} 円` : '0 円';
      roiEl.textContent = `${percent(roiValue)}`;
      trendMiniEl.textContent = schedule.length ? `${currency(schedule.reduce((sum, r) => sum + r.netCash, 0) / schedule.length)} 円` : '-';
      summaryNote.textContent = `年間キャッシュフロー: ${currency(annualCashFlow)} 円 / 1年後残債: ${currency(remainingAfterYear)} 円`;

      trendBody.innerHTML = '';
      if (!schedule.length) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.style.textAlign = 'center';
        td.textContent = '入力すると12ヶ月分の推移を表示します。';
        tr.appendChild(td);
        trendBody.appendChild(tr);
        return;
      }

      const formatter = new Intl.NumberFormat('ja-JP', { maximumFractionDigits: 0 });
      schedule.forEach((row) => {
        const tr = document.createElement('tr');
        const cells = [
          row.month,
          formatter.format(row.payment),
          formatter.format(row.principalPaid),
          formatter.format(row.interest),
          formatter.format(row.balance),
          formatter.format(row.netCash),
        ];
        cells.forEach((value, index) => {
          const td = document.createElement('td');
          if (index === 0) td.style.textAlign = 'left';
          td.textContent = value;
          tr.appendChild(td);
        });
        trendBody.appendChild(tr);
      });
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      calculate();
    });

    form.addEventListener('reset', () => {
      setTimeout(() => {
        statusEl.textContent = '';
        summaryNote.textContent = '入力すると自動で計算結果が表示されます。';
        trendBody.innerHTML = '';
        netCashEl.textContent = repayEl.textContent = roiEl.textContent = trendMiniEl.textContent = '-';
      }, 10);
    });

    Array.from(form.elements).forEach((el) => {
      if (el.tagName === 'INPUT') {
        el.addEventListener('input', () => {
          statusEl.textContent = '';
          calculate();
        });
      }
    });

    calculate();
  </script>
</body>
</html>
